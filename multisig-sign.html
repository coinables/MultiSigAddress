<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="bitcoin.js"></script>
<script type="text/javascript" src="buffer.js"></script>
</head>
<body>

<br>
<b>Select Network:</b> <select id="networkselect"><option value="testnet">Testnet</option><option value="mainnet">Mainnet</option></select>
<br>
<b>Redeem Script:</b> <input type="text" id="redeem"><br>
<b>WIF Private Key:</b> <input type="text" id="wifpk"><br>
<textarea id="hexin" cols="100" rows="10"></textarea><br>
<button id="signInc" onclick="return signIncomplete();">Sign Incomplete</button> <button id="signLast" onclick="return sign();">Last Signature</button>
<br><br>
<textarea id="hexout" cols="100" rows="10"></textarea><br>
<script>

/*
function buildTx(){
	var netselect = document.getElementById("networkselect").value;
	var NETWORK = netselect === "testnet" ? b.bitcoin.networks.testnet : b.bitcoin.networks.bitcoin;
	const tx = new b.bitcoin.TransactionBuilder(NETWORK);
	const prevOutScript = b.bitcoin.script.scriptHash.output.encode(b.bitcoin.crypto.hash160(buffer.bufferFrom("522102f0394cd877723cd9f0f98b8d0c55d264f3872d7bd9be5ccccfe633fa76884eb12102fbacaf5b78153373c6933a63f04d3a75ac8bc681c9cf7f57b00d6b83bf5e3cce210214e83b66e12891112224eef3f8d8cd81729748176b17ac85a06412c96555554053ae")));
	tx.addInput('b66cadef36fa01f8def08f3728b1df1ac33d0a04c1a9a28e9b7c64a210c39da2', 1, null, prevOutScript);
	tx.addOutput('2N6ensJAB2KpWpVZBHhhx6hDHfqaRdk4PDp', 100000);
	const tx2 = tx.buildIncomplete();
	console.log(tx2.toHex());
}
*/

/*function decodeTx(){
	var netselect = document.getElementById("networkselect").value;
	var NETWORK = netselect === "testnet" ? b.bitcoin.networks.testnet : b.bitcoin.networks.bitcoin;
	txhash = "010000000147f6a48c921df9ba95281f0815ea4cea80a77840e24d70b054d0aa1c0cd3789c01000000fdfd0000473044022042f8aaf1a935d2437d52bb34c5ea0aa51b3cf3798d238403667fbc15d2b6d4b7022073a95e3544ed38d8d2befa68dcc4249b5541cb295e2a2195e114372c5df10379014830450221009d5e16a2abc6da3fe0a9ce01d20d6e5b3b1d72b5eeac9fd96ad00dfabb75edc90220604b3f8737af02d45fe541abe8cb8dc5cac8b644773610d90751c625ad66500c014c69522102f0394cd877723cd9f0f98b8d0c55d264f3872d7bd9be5ccccfe633fa76884eb12102fbacaf5b78153373c6933a63f04d3a75ac8bc681c9cf7f57b00d6b83bf5e3cce210214e83b66e12891112224eef3f8d8cd81729748176b17ac85a06412c96555554053aeffffffff01a08601000000000017a914930ea61512dc7a8f0269bdb617283499b40bc0d18700000000";
	const txb = b.bitcoin.TransactionBuilder.fromTransaction(b.bitcoin.Transaction.fromHex(txhash), NETWORK);
	console.log(txb);
	
}*/

function signIncomplete(){
	var netselect = document.getElementById("networkselect").value;
	var NETWORK = netselect === "testnet" ? b.bitcoin.networks.testnet : b.bitcoin.networks.bitcoin;
	//var WIF = "cQRqfFxZZDAFDzJEf1enyjeUMHxzTDgNRo3M9WymGFPTebLGN5YV";
	var WIF = document.getElementById("wifpk").value;
	let keyPair = b.bitcoin.ECPair.fromWIF(WIF, NETWORK);
	var redeeminput = document.getElementById("redeem").value;
	var redeemScript = buffer.bufferFrom(redeeminput);
	var hexinput = document.getElementById("hexin").value;
	const txb = b.bitcoin.TransactionBuilder.fromTransaction(b.bitcoin.Transaction.fromHex(hexinput), NETWORK);
	//get number of inputs
	var subhex = hexinput.substring(7,10);
	var numberofinputs = parseInt(subhex);
	
	for(var i=0;i<numberofinputs;i++){
		txb.sign(i, keyPair, redeemScript);
	}
	
	// if the last signature:
	// const tx = txb.build();
	const tx = txb.buildIncomplete();
	document.getElementById("hexout").value = tx.toHex();
}

function signTx(){
	var netselect = document.getElementById("networkselect").value;
	var NETWORK = netselect === "testnet" ? b.bitcoin.networks.testnet : b.bitcoin.networks.bitcoin;
	//var WIF = "cUCbw7GN11xxmmJWTDvZbmESg23pAdcn1fF6HC4Ntwaf1u9x8C62";
	var WIF = document.getElementById("wifpk").value;
	let keyPair = b.bitcoin.ECPair.fromWIF(WIF, NETWORK);
	var redeeminput = document.getElementById("redeem").value;
	var redeemScript = buffer.bufferFrom(redeeminput);
	var hexinput = document.getElementById("hexin").value;
	const txb = b.bitcoin.TransactionBuilder.fromTransaction(b.bitcoin.Transaction.fromHex(hexinput), NETWORK);
	var subhex = hexinput.substring(7,10);
	var numberofinputs = parseInt(subhex);
	
	for(var i=0;i<numberofinputs;i++){
		txb.sign(i, keyPair, redeemScript);
	}
	// if the last signature:
	// const tx = txb.build();
	const tx = txb.build();
	document.getElementById("hexout").value = tx.toHex();
}

</script>

</body>
</html>